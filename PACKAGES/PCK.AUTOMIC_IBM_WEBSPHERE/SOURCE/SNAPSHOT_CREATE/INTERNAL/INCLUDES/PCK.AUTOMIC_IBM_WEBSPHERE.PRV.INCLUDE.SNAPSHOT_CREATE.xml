<?xml version="1.0" encoding="UTF-8"?>
<jobi>
   <metadata>
      <row>
         <version>12.3.1</version>
      </row>
   </metadata>
   <general_attributes>
      <row>
         <minimum_ae_version>11.2</minimum_ae_version>
         <child_flags>00000000000000000000000000000000</child_flags>
         <last_runtimes>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</last_runtimes>
         <name>PCK.AUTOMIC_IBM_WEBSPHERE.PRV.INCLUDE.SNAPSHOT_CREATE</name>
         <type>JOBI</type>
         <versioning_id>1333077187</versioning_id>
      </row>
   </general_attributes>
   <scripts>
      <row>
         <process><![CDATA[:SET &RET# = STR_MATCH(&UC4RB_ARCHIVE_PATH#, "&UC4RB_AGENT_WORKING_DIR#*")
:IF &RET# <> "Y"
:  SET &UC4RB_FULL_ARCHIVE_PATH# = "&UC4RB_AGENT_WORKING_DIR#/&UC4RB_ARCHIVE_PATH#"
:  PUBLISH &UC4RB_FULL_ARCHIVE_PATH#,, WORKFLOW
:ELSE
:  SET &UC4RB_FULL_ARCHIVE_PATH# = &UC4RB_ARCHIVE_PATH#
:  PUBLISH &UC4RB_FULL_ARCHIVE_PATH#,, WORKFLOW

:  SET &UC4RB_ARCHIVE_PATH# = STR_SUB(&UC4RB_ARCHIVE_PATH#,"&UC4RB_AGENT_WORKING_DIR#","")
!  Remove the final slash
:  SET &LEN# = STR_LENGTH(&UC4RB_ARCHIVE_PATH#)
:  SET &LEN# = &LEN# - 1
:  SET &SLASH# = STR_CUT(&UC4RB_ARCHIVE_PATH#, &LEN# , 1)
:  IF &SLASH# = "/" OR "\"
:    SET &UC4RB_ARCHIVE_PATH# = STR_CUT(&UC4RB_ARCHIVE_PATH#, 1 , &LEN#)
:  ENDIF
:ENDIF

:SET &UC4RB_CONVERTED_STRING# = &UC4RB_FULL_ARCHIVE_PATH#
:INC PCK.ITPA_SHARED.PRV.INCLUDE.CONVERT_SLASHES_UNIX_STYLE
:SET &UC4RB_FULL_ARCHIVE_PATH# = &UC4RB_CONVERTED_STRING#

: INC PCK.AUTOMIC_IBM_WEBSPHERE.PRV.INCLUDE.ATTACH_RES
: ATTACH_RES "PCK.AUTOMIC_IBM_WEBSPHERE.PRV.STORE", "SNAPSHOT_CREATE", T
: SET &UC4RB_CONVERTED_STRING# = "&$AGENT_RESOURCES_TASK#pck_websphere_snapshot_create.py"
: INC PCK.ITPA_SHARED.PRV.INCLUDE.CONVERT_SLASHES_UNIX_STYLE
: SET &UC4RB_JYTHON_FILE# = &UC4RB_CONVERTED_STRING#

: SET &UC4RB_WAS_CMD# = 'java -jar "&$AGENT_RESOURCES_CLIENT#itpa-tool.jar" '
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, 'arb -cmd execute ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"&WSADMIN#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '-username "&UC4RB_WAS_USERNAME#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '-password "&UC4RB_WAS_PASSWORD#" ')
: IF &UC4RB_WAS_HOST_TEMP# <> "localhost"
:  SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '-host "&UC4RB_WAS_HOST_TEMP#" ')
:  SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '-port "&UC4RB_WAS_PORT#" ' )
: ENDIF
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '-f "&UC4RB_JYTHON_FILE#" ')

! Add list argument of python to command
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"&UC4RB_WAS_WSADMINLIB#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"&UC4RB_WAS_UTILSLIB#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_BACKUP_DIRECTORY#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_ARCHIVE_PATH#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_OUT_TARGET_GUID#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_APP_NAME#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_APP_FILTER_EXCLUDE#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_OUT_SNAP_FILE#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_FULL_ARCHIVE_PATH#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_WAS_HOST#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_WAS_PORT#" ')
: SET &UC4RB_WAS_CMD# = STR_CAT(&UC4RB_WAS_CMD#, '"_PREF:&UC4RB_SNAPSHOT_MODE#" ')

: PRINT &UC4RB_WAS_CMD#
&UC4RB_WAS_CMD#
]]></process>
      </row>
   </scripts>
</jobi>
